{% extends 'base.html' %}
{% load static %}

{% block title %}
    Recomendations
{% endblock %}

{% block links %}
    <link type="text/css" rel="stylesheet" href="{% static 'styles/recomends.css' %}">
{% endblock %}

{% block content %}
    <h1 class="recomendstitle">
        Рекомендации
    </h1>
    {% for user in recommended_users %}
        <div class="card recomendations" style="width: 30rem">

            <div class="card-header">
                <div class="row">
                    <div class="col-md-6">
                        {{ user.username }} ({{ user.calculate_age }} годиков)
                    </div>
                    {% if 'M' in user.sex %}
                        <div class="sex col-md-6">
                            <img class="gender" title="Мужчина" src="{% static 'pictures/man.png' %}">
                        </div>
                    {% elif 'W' in user.sex %}
                        <div class="sex col-md-6">
                            <img class="gender" title="Женщина" src="{% static 'pictures/woman.png' %}">

                        </div>
                    {% elif 'ND' in user.sex %}
                        <div class="sex col-md-6">
                            <img class="gender" title="Не определен" src="{% static 'pictures/gender.png' %}">
                        </div>
                    {% endif %}
                </div>

            </div>
            <div class="row">
                <div class="col-md-4">
                    <img class="card-img-bottom" src="{{ user.user_image.url }}">
                </div>
                <div class="col-md-8">

                    <div class="card-body">
                        <div class="container">
                            <div class="scene">
                                <div class="flipcard card">
                                    <div class="card__face card__face--front">
                                        {{ user.user_description }}
                                    </div>
                                    <div class="card__face card__face--back">
                                        {{ user.last_name }} {{ user.first_name }}<br>
                                        День рождения: {{ user.birthday }}<br>
                                        Почта: {{ user.email }}<br>
                                        Живёт: {{ user.user_country }}, {{ user.user_city }}
                                    </div>
                                </div>
                            </div>
                            <form class="like-form" id="{{ user.pk }}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn">
                                        <i class="fa fa-thumbs-o-up"></i>
                                        <span id="likes" class="text-dark">{{ user.get_user_likes }}</span>
                                    </button>
                                </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
    <div class="row" style="margin-bottom: 150px">

    </div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="{% static 'js/description-animation.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(document).on('submit', $('.like-form'), (function (e) {
                    e.preventDefault();
                    const formID = $(e.target).attr('id');
                    const targetFormString = '.like-form' + '#' + formID;
                    var form = $(targetFormString);
                    const data = form.serializeArray();
                    data.push({name: 'pk', value: formID})
                    $.ajax({
                        data: data,
                        url: "{% url 'user_likes' %}",
                        dataType: 'json',
                        method: "POST",
                        cache: false,
                        success: function (response) {
                            if (response.success === true) {
                                const targetElement = targetFormString + ' button';
                                if (response.action === 'create') {
                                    $(targetElement).html(
                                        '<i class="fa fa-thumbs-up"></i>' +
                                        '<span id="likes" class="text-dark">' + response.user_likes + '</span>');
                                }
                                if (response.action === 'delete') {
                                    $(targetElement).html(
                                        '<i class="fa fa-thumbs-o-up"></i>' +
                                        '<span id="likes" class="text-dark">' + response.user_likes + '</span>');
                                }
                            }
                        }
                    });
                })
            );
        });
    </script>
{% endblock %}

